---
owner: "#data-infra"
---

# Hausmeister

## Setup

Make sure your work environment is set up and you have the following:

- [VPN functioning properly](https://nubank.slack.com/archives/C024U9800/p1545380162000900).
- know your way around [Airflow](/airflow.md).
- know [how to use sabesp](/cli_examples.md).
- have a [GraphQL client accessible](../../tools/graphql_clients.md).

## Required knowledge

A Hausmeister should be familiarized with the following:

- [Sabesp](/cli_examples.md)
- Itaipu and the phases of run
- Datasets management - Datomic datasets and dataset series
- [Airflow](/airflow.md)
- [Aurora](https://github.com/nubank/aurora-jobs)

Once you're familiar with the above, make sure you gain knowledge on the following:

- Basic Unix service management (when SSH-ing into instances).
- The AWS services they run on, in particular EC2, but also in some cases Cloud Formation.
- The GoCD pipelines and how they work (for example, in cases when pipelines are changed and fail, preventing proper deploys).
- Grafana and Splunk dashboards.

In addition to the above, Hausmeisters also need to be aware of any major changes implemented recently that might impact the run. Data Infra engineers are encouraged to post about any non-trivial changes to the infrastructure in `#di-hausmeister`. Join the `#di-prs` Slack Channel for data-infra related PRs.

The on-call rotation is divided into several shift types:

- **Level 1 (Primary Hausmeister)**

**Weekday (_Monday 6pm - Friday 6pm_)**

   1. **_non-work hours_** Hausmeister must ensure our services and DAG runs operate smoothly.
   2. **_work hours_** Hausmeister is responsible for triaging issues, addressing customer inquiries, and resolving [soft alarms](#handling-alerts-and-issues).

**Weekend (_Friday 6pm - Monday 6pm_)** - Same as weekday, but not responsible for customer inquiries.

- **Level 2 (Secondary Hausmeister)**

**(_Monday - Monday_)**: A supporting engineer with more ops experience to support the Level 1. This is the first person the hausmeister can elevate an issue to if he/she needs assistance.

At the end of each shift, any pending open issues are handed over to the next Level 1 Hausmeister.

## Outside of work hours: pager duty

Outside of work hours, your sole responsibility as a Hausmeister is to respond to hard alerts, for which you will be notified via OpsGenie. This means that:

- you should have a phone with [OpsGenie](http://opsgenie.com/) configured with you at all times.
- your work-configured laptop should be readily available to address any alerts you receive from OpsGenie.

If an issue comes up that you cannot handle independently, you should escalate the alert to the Level 2 and pair with them to resolve the issue.

### Handling Alerts and Issues

Alerts are generated by any one of the following:

### Alerts

- [Alertmanager](https://prod-alertmanager.nubank.com.br/), a tool integrated with Prometheus and maintained by the Nubank platform team to define alerts for Clojure services. You can configure the alerts to be triggered based on specific monitoring data patterns in Prometheus.
- Airflow, for alerts to be triggered when a DAG node fails. Regardless of whether a node alerts or not, the severity of the alert, is defined in [aurora-jobs](https://github.com/nubank/aurora-jobs).
- Splunk, for alerts to be triggered for certain search results. You can create custom alerts in Splunk.

When one of the above generates an alert, it then notifies us as hard and soft alarms:

|Alarm type|Notification channels|Description|
|--------------|----------|------------|
|Hard|**[#data-crash](https://nubank.slack.com/archives/CE98NE603)** & [OpsGenie](https://nubank.app.opsgenie.com/alert/list)| Alerts that require an immediate action. The On-Call Engineer should always have a device ready to receive hard alerts, and should aim to resolve them as soon as possible.|
|Soft|**[#squad-di-alarms](https://nubank.slack.com/archives/C51LWJ0SK)**|Alerts which don't require an immediate action. The Soft alerts can usually wait until the next work-day if they are notified during non-working hours. There is no expectation for the On-Call Engineer to monitor them during non-working hours. The Soft alerts need to be addressed in a timely manner during working hours, as they usually can have a negative impact on the run if left unattended for too long.|

### Issues

- Before handling an issue, be sure to go through the [Data Incident Response Checklist](/on-call/data-infra/incident_response_checklist.md).

- Read through [the runbook](/on-call/data-infra/on_call_runbook.md) to know how to handle the raised alert.

- Read through [Operations Cookbook](/on-call/data-infra/ops_how_to.md) for common maintenance operations. Consider contributing back to it if you come across a repeated task that is worth sharing.

### Escalating

Don't be afraid to ask the Level 2 Hausmeister for help if you need to. Here are some non-comprehensive guidelines on when to escalate:

- If you want to start working on an issue, but don't know where to start;
- If you try to solve an issue for more than one hour and feel you are not making progress;
- If you don't know how to prioritize a new incoming issue.

- During working hours, ping the level 2 Hausmeister on `#di-hausmeister` Slack channel.
- During non-working hours, use the **Escalate** button in OpsGenie.

**Note** Outside of work hours:
      - Escalate as soon as you think that more knowledge is needed to tackle the problem efficiently. The priority is always to restore the run to a working state as soon as possible.
      - Escalate if you're missing the context and think that the level 2 Hausmeister may have (so not necessarily after 1 hour).

## During work hours: monitoring run

Use the following Slack channels to monitor the normal operation of our services:

- The [#squad-di-alarms](https://nubank.slack.com/messages/C51LWJ0SK/) slack channel
- General DAG status via [airflow](https://airflow.nubank.com.br/admin/airflow/graph?dag_id=prod-dagao): you should check the status of the DAG every few hours during working hours to make sure things are progressing smoothly.
- At-a-glance DAG status via [#etl-updates](https://nubank.slack.com/messages/CCYJHJHR9/): It is also a good idea to pay attention to the ETL status updates posted to the slack channel [#etl-updates](https://nubank.slack.com/messages/CCYJHJHR9/). It can be a quick way to notice irregularities in the run. You can compare the messages from one day to the other to understand how late or early you are.

### During work hours: support our Clients

Over the course of the week our customers (Nubank's data scientists, business analysts, data analysts, etc), often encounter platform issues while using our services. To support their effectiveness, the Hausmeister is responsible for communicating with these users; looking into their issues in a timely manner.

#### Slack channels

The slack channels you should monitor for user questions are:

|Slack channels|
|--------------|
|[#squad-data-infra](https://nubank.slack.com/messages/C0XRWDYQ2/)|
|[#data-tribe](https://nubank.slack.com/archives/C1SNEPL5P)|
|[#data-announcements](https://nubank.slack.com/messages/C20GTK220/)|
|[#data-help](https://nubank.slack.com/messages/C06F04CH1/)|
|[#di-hausmeister](https://nubank.slack.com/archives/CP3F163C4)|
|[#etl-integrity-checks](https://nubank.slack.com/archives/CGBLGLYFK) - For failing datasets|

**Important**: As a Hausmeister, your role is to ensure user's problems are addressed, but this does not mean that you are responsible for fixing every single problem you encounter yourself; the reason being that you should always make sure you have the headspace necessary to tackle a hard alarm when it is notified. Do not hesitate to rope in other data infra engineers to help with user requests, and in particular to involve engineers closer to the context of the request who will be able to fix it quicker.

### During work hours: address the Hausmeister Backlog

During your Level 1 on-call rotation you usually encounter bugs and corner cases in our system. The following should make it to the Hausmeister backlog, which we track on [clubhouse](https://app.clubhouse.io/nubank/project/352/data-infra-hausmeister):

- Items about improving the visibility, monitoring, maintenance, and operation of our infrastructure. In short, items which improve the workflow for the primary Hausmeister.
- Low-hanging non-blocking bugs observed as part of the hausmeister's attempts to keep the DAG running. More laborious fixes should be part of pack backlogs.

 Items with non-immediate payoff, such as “good-to-have” features, should be moved to pack backlogs.

Backlog tickets should be annotated with a "why", as in, the benefit of completing the particular work-item.

Tickets which the question ‘ *will it come back to bite the Hausmeister in the future?* ’ can't be answered with "yes" shouldn't belong on the hausmeister backlog.

From a resourcing perspective, the on-call enginer is resourced exclusively as hausmeister during their rotation. If there aren't any open issues you are working on, feel free to tackle issues in the hausmeister backlog or general tech-debt.

## See also

- [Monitoring nightly run](monitoring_nightly_run.md)
- [Operations How-Tos](ops_how_to.md)
- [On-call runbook](on_call_runbook.md)
